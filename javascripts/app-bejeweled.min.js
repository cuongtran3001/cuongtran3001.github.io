window.Org=window.Org||{},function(a,b){"use strict";var c=function(a){this.data=a,this.initialize()},d=c.prototype=new b.Shape;d.data=null,d.initialize=function(){this.cursor="pointer",this.mouseChildren=!1,this.x=this.data.x+10,this.y=this.data.y+10},a.BejeweledItem=c}(window.Org,window.createjs),function(a,b,c,d){"use strict";function e(b){return this.settings=a.extend({},f,b),this.stage=null,this.groups=null,this.group=null,this.container=null,this.arrPersonItem=null,this.TOTAL_COL=17,this.TOTAL_ROW=8,this.ITEM_WIDTH=70,this.ITEM_HEIGHT=70,this.matrix=[],this.sprItem=null,this.sprSelect=null,this.isWait=!1,this.previousRow=-10,this.previousCol=-10,this.init()}var f={};e.prototype.init=function(){this.stage=new b.Stage("cvsOrg"),this.container=new b.Container,this.stage.addChild(this.container),this.sprItem=new b.Container,this.sprItem.x=this.sprItem.y=35,this.stage.addChild(this.sprItem),this.drawBackground(),this.sprSelect=new b.Shape,this.sprSelect.graphics.beginFill("#FFFF00").drawRect(1,1,this.ITEM_WIDTH-2,this.ITEM_HEIGHT-2).endFill(),this.sprSelect.visible=!1,this.sprItem.addChild(this.sprSelect),this.createBejeweledItem();var a=this;b.Ticker.addEventListener("tick",function(b){a.stage.update(),a.checkResult()})},e.prototype.drawBackground=function(){var a=new b.Shape;a.x=a.y=35;for(var c=this.ITEM_WIDTH*(this.TOTAL_COL-1),d=this.ITEM_HEIGHT*(this.TOTAL_ROW-1),e=0;e<this.TOTAL_ROW;e+=1)a.graphics.s("#000000").moveTo(0,this.ITEM_WIDTH*e).lineTo(c,this.ITEM_WIDTH*e);for(e=0;e<this.TOTAL_COL;e+=1)a.graphics.s("#000000").moveTo(this.ITEM_HEIGHT*e,0).lineTo(this.ITEM_HEIGHT*e,d);this.container.addChild(a)},e.prototype.createBejeweledItem=function(){for(var a,c,d=0,e=this,f=0;f<this.TOTAL_ROW-1;f+=1){this.matrix[f]=[];for(var g=0;g<this.TOTAL_COL-1;g+=1){do this.matrix[f][g]=Math.ceil(5*Math.random());while(this.checkRow(f,g)>2||this.checkCol(f,g)>2);d=this.matrix[f][g],c=this.createShapeByType(d),c.x=c.y=10,a=new b.Container,a.mouseChildren=!1,a.name=f+"_"+g,a.x=g*this.ITEM_WIDTH,a.y=f*this.ITEM_HEIGHT,a.addChild(c),a.addEventListener("click",function(a){e.onClickHandler(a)}),this.sprItem.addChild(a)}}},e.prototype.onClickHandler=function(a){var c,d,e,f=this,g=a.target,h=g.name.split("_"),i=Number(h[0]),j=Number(h[1]);(i!==this.previousRow+1&&i!==this.previousRow-1||j!==this.previousCol)&&(j!==this.previousCol+1&&j!==this.previousCol-1||i!==this.previousRow)?(this.previousRow=i,this.previousCol=j,this.sprSelect.x=g.x,this.sprSelect.y=g.y,this.sprSelect.visible=!0):(this.swapItem(this.previousRow,this.previousCol,i,j),this.checkRow(this.previousRow,this.previousCol)>2||this.checkCol(this.previousRow,this.previousCol)>2||this.checkRow(i,j)>2||this.checkCol(i,j)>2?(this.isWait=!0,c=this.sprItem.getChildByName(this.previousRow+"_"+this.previousCol),c.name="_temp_",b.Tween.get(c,{override:!0}).to({x:j*this.ITEM_WIDTH,y:i*this.ITEM_HEIGHT},200),c=this.sprItem.getChildByName(i+"_"+j),c.name=this.previousRow+"_"+this.previousCol,b.Tween.get(c,{override:!0}).to({x:this.previousCol*this.ITEM_WIDTH,y:this.previousRow*this.ITEM_HEIGHT},200).call(function(){f.isWait=!1}),this.sprItem.getChildByName("_temp_").name=i+"_"+j):(this.isWait=!0,d=this.sprItem.getChildByName(this.previousRow+"_"+this.previousCol),e=this.sprItem.getChildByName(i+"_"+j),b.Tween.get(d,{override:!0}).to({x:e.x,y:e.y},200),b.Tween.get(e,{override:!0}).to({x:d.x,y:d.y},200).wait(200).call(this.swapAgain,[d,e],this),this.swapItem(this.previousRow,this.previousCol,i,j)),this.previousRow=-10,this.previousCol=-10,this.sprSelect.visible=!1)},e.prototype.swapAgain=function(a,c){b.Tween.get(a,{override:!0}).to({x:c.x,y:c.y},200),b.Tween.get(c,{override:!0}).to({x:a.x,y:a.y},200),this.isWait=!1},e.prototype.createShapeByType=function(a){var c=new b.Shape;return 1===a?c.graphics.beginFill("#FF0000").drawRect(0,0,50,50).endFill():2===a?c.graphics.beginFill("#32CD32").drawRect(0,0,50,50).endFill():3===a?c.graphics.beginFill("#0000FF").drawCircle(25,25,25).endFill():4===a?c.graphics.beginFill("#FF00FF").drawCircle(25,25,25).endFill():5===a&&c.graphics.beginFill("#800080").moveTo(25,0).moveTo(50,50).lineTo(0,50).lineTo(25,0).endFill(),c},e.prototype.checkRow=function(a,b){for(var c=this.matrix[a][b],d=1,e=b;this.checkType(c,a,e-1);)e-=1,d+=1;for(e=b;this.checkType(c,a,e+1);)e+=1,d+=1;return d},e.prototype.checkCol=function(a,b){for(var c=this.matrix[a][b],d=1,e=a;this.checkType(c,e-1,b);)e-=1,d+=1;for(e=a;this.checkType(c,e+1,b);)e+=1,d+=1;return d},e.prototype.checkType=function(a,b,c){return this.matrix[b]&&this.matrix[b][c]?a===this.matrix[b][c]:!1},e.prototype.swapItem=function(a,b,c,d){var e=this.matrix[a][b];this.matrix[a][b]=this.matrix[c][d],this.matrix[c][d]=e},e.prototype.checkResult=function(){if(!this.isWait){var a=this.moveItem();if(!a){var b=this.createItem();if(!b){var c=this.replaceItems();c||(this.isWait=!0)}}}},e.prototype.moveItem=function(){var a,c,d,e,f=!1;for(c=this.TOTAL_ROW-3;c>=0;c-=1)for(d=0;d<this.TOTAL_COL-1;d+=1)-1!==this.matrix[c][d]&&-1===this.matrix[c+1][d]&&(this.matrix[c+1][d]=this.matrix[c][d],this.matrix[c][d]=-1,a=this.sprItem.getChildByName(c+"_"+d),e=a.y+this.ITEM_HEIGHT,a.name=c+1+"_"+d,b.Tween.get(a,{override:!0}).to({y:e},150),f=!0);if(f){this.isWait=!0;var g=this;b.Tween.get(this,{override:!0}).to({alpha:1},200).call(function(){g.isWait=!1})}return!1},e.prototype.createItem=function(){var a,c,d,e,f=this;for(c=this.TOTAL_ROW-2;c>=0;c-=1)for(d=0;d<this.TOTAL_COL-1;d+=1)if(-1===this.matrix[c][d])return this.matrix[0][d]=Math.ceil(5*Math.random()),e=this.createShapeByType(this.matrix[0][d]),e.x=e.y=10,a=new b.Container,a.mouseChildren=!1,a.name="0_"+d,a.x=d*this.ITEM_WIDTH,a.y=0,a.addChild(e),a.addEventListener("click",function(a){f.onClickHandler(a)}),this.sprItem.addChild(a),!0;return!1},e.prototype.replaceItems=function(){var a,c,d,e,f,g,h,i,j=!1,k=this;for(a=this.TOTAL_ROW-2;a>=0;a-=1){for(c=0;c<this.TOTAL_COL-1;c+=1)if(this.checkRow(a,c)>2||this.checkCol(a,c)>2){if(j=!0,e=[a+"_"+c],f=this.matrix[a][c],this.checkRow(a,c)>2){for(g=c;this.checkType(f,a,g-1);)g-=1,e.push(a+"_"+g);for(g=c;this.checkType(f,a,g+1);)g+=1,e.push(a+"_"+g)}if(this.checkCol(a,c)>2){for(g=a;this.checkType(f,g-1,c);)g-=1,e.push(g+"_"+c);for(g=a;this.checkType(f,g+1,c);)g+=1,e.push(g+"_"+c)}for(h=0;h<e.length;h+=1)this.isWait=!0,d=this.sprItem.getChildByName(e[h]),i=e[h].split("_"),this.matrix[i[0]][i[1]]=-1,b.Tween.get(d,{override:!0}).to({alpha:0,scaleX:5,scaleY:5},.3).call(function(a,b){a.parent&&a.parent.removeChild(a),b&&(k.isWait=!1)},[d,h===e.length-1]);break}if(j)break}return j},a(function(){var a={};d.bejeweled=new e(a)})}(window.jQuery,window.createjs,window.Org,window.App);